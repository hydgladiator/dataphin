# 新建与修改事实逻辑表 {#concept_s3t_ccp_fhb .concept}

归属于某个业务过程的事实逻辑表，丰富具体业务过程所对应事务的详细信息。创建事实逻辑表即完成公共的事务明细数据沉淀，从而便于提取业务中事务相关的明细数据。

**说明：** 抽象提炼事务的描述性信息，无需冗余事务相关联维度的属性信息。

## 新建事实逻辑表 {#section_3wa_efw_xvl .section}

1.  进入**研发** \> **开发** \> **规范建模** \> **事实逻辑表**功能菜单。
2.  新建事实逻辑表有四个操作入口，具体如下。
    -   项目名称右侧的“加号”图标，单击“加号”后，选择**逻辑表** \> **事实逻辑表**。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104441910_zh-CN.png)

    -   左侧功能区右上方的**新建文件**图标，如下图所示。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104541911_zh-CN.png)

    -   上事实逻辑表模块下方的“加号”图标，如下图所示。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104541917_zh-CN.png)

    -   通过**业务过程对象列表**，选择某个具体的业务过程，单击**操作**栏的**创建逻辑表**按钮。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104541918_zh-CN.png)

3.  通过上述操作入口，进入新建事实逻辑表页面。
4.  事实逻辑表的基本信息定义，如下图所示。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/149067/155599104541747_zh-CN.png)

    事实逻辑表的基本信息，包括如下几部分：

    -   所属业务板块及项目：不需要填写，系统默认。
    -   所属业务过程及对应的数据域：必填项。
    -   明细类型：必填项，可选**事务型**和**周期快照型**。

        **说明：** 

        -   事务型，针对业务发生过程中的事件（即业务过程）进行跟踪和度量，如针对订单业务发生过程中的支付订单事件进行设计。
        -   周期快照型，则主要针对实体的状态进行周期性的度量，如账户余额、商品库存等。
    -   中、英文名称及描述：英文名，命名格式为fct\_业务过程\_\[自定义部分\]\_di/df，其中自定义部分非必填；后缀di/df，针对事务型为di，表示天增量数据，针对周期快照型则为df，表示天全量数据。
    -   来源主表：确定此事实逻辑表的来源表，可以是物理表，也可以是逻辑表。
5.  首先需要填写事实逻辑表的基本信息，根据界面提示填写即可。

    基本信息包括如下几部分：

    -   所属业务板块及项目：不需要填写，系统默认。
    -   所属业务过程及对应的数据域：必填项。
    -   明细类型：必填项，可选**事务型**和**周期快照型**。

        **说明：** 

        -   事务型，针对业务发生过程中的事件（即业务过程）进行跟踪和度量，如针对订单业务发生过程中的支付订单事件进行设计。
        -   周期快照型，则主要针对实体的状态进行周期性的度量，如账户余额、商品库存等。
    -   中、英文名称及描述：英文名，命名格式为fct\_业务过程\_\[自定义部分\]\_di/df，其中自定义部分非必填；后缀di/df，针对事务型为di，表示天增量数据，针对周期快照型则为df，表示天全量数据。
    -   来源主表：确定事实逻辑表的来源表，可以是物理表，也可以是逻辑表。
6.  事实逻辑表的主键定义。
    -   不设定主键，表示事实逻辑表没有主键，此时可以填写主表的筛选条件，不需要填写where关键词，直接填写筛选条件，此项为非必填项。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/149067/155599104541749_zh-CN.png)

    -   设定主键，表示事实逻辑表有主键，此时需要填写主键信息和主键计算逻辑。

        **说明：** 

        -   事实逻辑表如果有唯一的主键（如订单id），后续添加的字段需要关联至事实逻辑表的主键，即字段计算逻辑里需要将被关联的字段写为系统标识关联键的关键字k，如order\_id as k。
        -   事实逻辑表如果无唯一的主键（如浏览明细表），所添加的字段的计算逻辑中如有union、join，需要保证SQL中引用了该来源表，且SQL计算逻辑加工出的记录需要在事实逻辑表的来源表记录范围内。
        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/149067/155599104641750_zh-CN.png)

7.  通过上述步骤的基本信息和主键定义之后，进入事实逻辑表初始状态。

    如下图所示， 操作区域主要包含三个：左上区域的表信息、物理化配置、主表编辑等；主表区域中间区域的添加关联维度、添加度量、添加事实属性；主表区域右上区域的搜索字段、收起/折叠字段、主表详情和业务过程查看。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/149067/155599104641755_zh-CN.png)

    -   左上区域：

        表信息：查看和编辑基本信息和主键定义两个步骤所定义的表信息。其中，如果表名称已经在指标规范定义中使用，则不再允许修改数据域、业务过程、表类型和英文名。

        物理化配置：配置逻辑表物理化时的约束，包括物理表的存储生命周期、分区字段和无需物理化字段。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104644779_zh-CN.png)

        主表编辑：用于添加事实逻辑表的字段，详见后续步骤。

    -   主表区域中间区域，同主表编辑，用于添加事实逻辑表的字段，详见后续步骤。
    -   主表区域右上区域，用于搜索字段、查看主表信息和对应业务过程。
8.  主表编辑。

    事实逻辑表主要工作区域，用于添加事实逻辑表的字段，包括三种类型的字段：度量、事实属性和关联维度。其中，度量一般为数值型数据，作为事实逻辑表的事实；事实属性则为事实逻辑表的描述信息；关联维度则将事实属性中的外键字段关联对应维度。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104644782_zh-CN.png)

    1.  新建度量。
        -   **引入字段**方式，可以从某来源主表中选择若干字段批量引入，字段英文名称、字段名称、数据类型、计算逻辑等自动生成，可以编辑、删除。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104741924_zh-CN.png)

        -   **SQL自定义字段**方式，可以通过自定义SQL方式批量引入来源逻辑相同的若干字段。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104741925_zh-CN.png)

    2.  新建事实属性，操作同新建度量。
    3.  新建关联维度。选择事实属性或度量（一般度量不会作为外键关联维度，适用于之前定义错误-将属性定义为度量的情况），选择相应的维度，建立关联关系，则此字段变更关联维度字段。维度角色英文名、角色名称默认为维度的英文名和中文名；默认值默认为-110，默认值的含义是事实表此外键字段和维度表关联时，如果关联不上时的默认赋值。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104741927_zh-CN.png)

    4.  主表编辑字段操作区。事实逻辑表字段可以**按类型分组**或**按来源分组**进行展示。**按类型分组**展示分为五个区，分别为主键区、关联维度区、事实属性区、度量区、系统字段区；**按来源分组**展示则根据计算逻辑中的来源表进行分组。****

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104744783_zh-CN.png)

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104744784_zh-CN.png)

        -   编辑模型关系。可以对关联维度、事实属性、度量三种字段进行类型切换，针对关联维度字段或切换为关联维度的字段，则需要编辑关联关系和定义维度角色，具体操作同新建关联维度；针对事实属性和度量字段，则不需要编辑。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104741933_zh-CN.png)

        -   编辑字段的计算逻辑。已经定义的字段，可以重新编辑其计算逻辑，后面的绿色✔图标“![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104744788_zh-CN.png)”表示计算逻辑通过校验。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104741936_zh-CN.png)

            其中，勾选**合并计算逻辑**，则将计算逻辑相同的字段进行合并，可以批量编辑其计算逻辑。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104841937_zh-CN.png)

        -   编辑字段。编辑字段英文名、中文名称、描述、数据类型等。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104841941_zh-CN.png)

9.  通过上述步骤的基本信息和主键定义之后，进入事实逻辑表初始状态。

    操作区域主要包含三个：左上方区域的表信息、物理化配置、主表编辑等；主表区域中间区域的添加关联维度、添加度量、添加事实属性；主表区域右上区域的搜索字段、收起/折叠字段、主表详情和业务过程查看。

    -   物理化配置：可参照维度逻辑表的[物理化配置](cn.zh-CN/用户指南/数据建模研发/逻辑表-维度逻辑表/编辑维度逻辑表/物理化配置.md#)。
    -   主表编辑：参照维度逻辑表的[主表编辑](cn.zh-CN/用户指南/数据建模研发/逻辑表-维度逻辑表/编辑维度逻辑表/主表编辑.md#)。
10. 调度配置：操作同维度逻辑表的调度配置，详情参见[调度配置](cn.zh-CN/用户指南/数据建模研发/逻辑表-维度逻辑表/编辑维度逻辑表/调度配置.md#)。
11. 提交发布。

    完成模型设计之后，在模型的右上操作区，单击**提交**。此操作区的偷锁功能同其他模块，不再赘述。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/150112/155599104841942_zh-CN.png)

    同维度逻辑表，事实逻辑表编辑界面支持列表筛选、过滤，以及定义公用计算逻辑、查看表计算逻辑、物理化配置、逻辑表调度配置等。

12. 事实逻辑表发布后，后台代码会自动化生成并进行周期调度。逻辑表发布需要生产账号，而非个人账号，并且对所用表有权限。

## 修改事实逻辑表 {#section_stp_nsh_rey .section}

事实逻辑表的修改操作与新建相同。

