---
keyword: Flink\_Template\_SQL
---

# 新建Flink\_Template\_SQL计算任务

本文为您介绍如何创建Flink\_Template\_SQL类型的计算任务。

完成代码模板的创建，详情请参见[新建代码模板](/cn.zh-CN/数据开发/数据处理/开发流批一体任务/新建代码模板.md)。

项目绑定了Flink计算源，即可新建Flink\_Template\_SQL任务。Flink\_Template\_SQL任务支持处理离线与实时数据。

新建的Flink\_Template\_SQL计算任务默认为开启实时模式。您可以手动开启离线模式。

## 步骤一：新建Flink\_Template\_SQL任务

1.  登录[Dataphin控制台](https://dataphin.console.aliyun.com/workingArea)。

2.  在Dataphin控制台页面，选择工作区地域后，单击**进入Dataphin\>\>**。

    您可以通过以下方式，快速进入数据开发模块：

    -   单击**快速开始相关工作**区域的**数据研发**。
    -   单击**快速进入研发项目**区域的**Dev**或**Basic**项目，选择开发数据的项目空间。
    **说明：**

    -   如果您通过**快速开始相关工作**进入数据开发模块，则跳过步骤3。
    -   如果您通过**快速进入研发项目**进入数据开发模块，则跳过步骤3和4。
3.  在Dataphin首页，单击顶部菜单栏**研发**。

4.  在数据**开发**页面，单击项目名称后的![test](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3497549951/p110384.png)图标后，单击**Dev**或**Basic**页签，选择数据开发的项目空间。

    如果您当前访问的是**Dev**或**Basic**项目，且项目空间为您的数据开发空间，则无需选择项目空间。

5.  在数据**开发**页面，单击**数据处理**。

    如果进入数据**开发**页面后，系统默认进入**数据处理**页签，则无需再次单击**数据处理**。

6.  在**数据处理**页签，单击左侧导航栏![agaga](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8980863061/p176215.png)**计算任务**图标。

7.  新建Flink\_Template\_SQL计算任务。

    1.  在**计算任务**页面，进入**新建FLINK\_TEMPLATE\_SQL**对话框。

        -   单击**计算任务**后的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8397549951/p72394.png)图标，选择**FLINK\_TEMPLATE\_SQL**。
        -   单击项目名称后的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8397549951/p72706.png)图标，选择**数据处理** \> **计算任务** \> **FLINK\_TEMPLATE\_SQL**。
        -   在**开发**首页，单击**FLINK\_TEMPLATE\_SQL**后的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8397549951/p72708.png)图标。
    2.  在**新建Flink\_Template\_SQL**对话框，配置参数。

        ![veshi](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5397549951/p97562.png)

        |参数|描述|
        |--|--|
        |**名称**|实时计算任务的名称。 名称支持由小写英文字母、数字、下划线（\_）组合组成。名称的限制如下：         -   名称的长度范围为3~62个字符。
        -   项目内的名称不支持重复。
        -   名称仅支持以英文字母开头。 |
        |**选择目录**|实时计算任务所属的目录。|
        |**资源队列**|该项目所绑定的实时计算源中的资源队列。|
        |**引擎版本**|资源队列的版本。|
        |**引用模板**|需要引用的模板。|

    3.  单击**确定**。


## 步骤二：开发Flink\_Template\_SQL任务的代码

1.  在Flink\_Template\_SQL任务代码页面，编写任务的代码。

2.  单击页面右上方的**预编译**，校验代码任务的语法及权限问题。

    您可以单击页面右上方的**格式化**，系统自动调整SQL代码格式。


## 步骤三：配置资源

配置Flink\_Template\_SQL任务中的资源信息。

1.  在Flink\_Template\_SQL任务代码开发页面，单击页面上方的**定向配置**。

2.  在**定向配置**面板的**资源配置**区域，您可以执行以下操作。

    -   配置**资源配置类型**，默认选择为**系统推荐配置**。您也可以选中**自定义配置**后，单击**去配置**，配置参数。

        |模式|描述|
        |--|--|
        |可视化配置|您可以配置资源组节点和组件节点的执行参数。 配置资源组节点的执行参数：

        1.  在配置资源类型页面，单击**可视化模式**。
        2.  单击资源组上方的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8397549951/p72545.png)图标。
        3.  在对话框中，配置参数。
        4.  单击**确定**，完成资源组的执行参数的配置。
        5.  完成配置DAG图中所有资源组节点的执行参数后，单击页面右上角的**保存**。
配置资源组中组件节点的执行参数：

        1.  在配置资源类型页面，单击**可视化模式**。
        2.  单击资源组上方的![test](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8397549951/p112869.png)图标，展开该组。
        3.  单击节点右上角的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8397549951/p72545.png)图标。
        4.  在对话框中，配置参数。
        5.  单击**确定**，完成组件节点执行参数的配置。
        6.  完成配置DAG图中所有资源组节点的执行参数后，单击页面右上角的**保存**。 |
        |代码模式|配置资源组节点和组件节点的执行参数：         1.  在配置资源类型页面，单击**代码模式**。
        2.  根据代码页面提示，定义资源组和组件节点的执行参数，单击页面右上角的**保存**。 |

    -   如果**资源配置类型**为**自定义配置**，则单击**资源信息记录**后的**保存当前配置为新纪录**。在**保存资源记录**对话框中，输入**资源记录名称**后，单击**确定**。

        对已有的资源信息记录，您可以执行以下操作。

        |操作|描述|
        |--|--|
        |查看版本信息|单击某个记录**操作**列下的![tesga](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9397549951/p112980.png)图标，查看版本信息。|
        |启用记录|        1.  单击某个记录的操作列下的![taga](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9397549951/p112981.png)图标。
        2.  在**提示**对话框中，单击**确定**。 |
        |删除记录|        1.  单击某个记录**操作**列下的![teag](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9397549951/p112985.png)图标。
        2.  在**提示**对话框中，单击**确定** |

    -   打开**自动调优**开关，配置**最大CU数**和**期望最大内存**，开启自动调优。

## 步骤四：配置依赖关系

1.  在Flink\_Template\_SQL任务代码开发页面，单击页面上方的**定向配置**。

2.  在**定向配置**面板的**依赖关系**区域，配置依赖关系。

    ![fa'ga'gfagag](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1334955061/p176321.png)

    |参数|描述|
    |--|--|
    |**自动解析**|当节点的任务类型为SQL时，您可以单击**自动解析**，系统会解析代码中的表，并查找到与该表名相同的输出名称。输出名称所在的节点作为当前节点的上游依赖。如果代码中引用项目变量或不指定项目，则系统默认解析为生产项目名，以保证生成调度的稳定性。例如，开发项目名称为`onedata_dev`：

    -   如果代码里指定`select * from s_order`，则调度解析依赖为`onedata.s_order`。
    -   如果代码里指定`select * from ${onedata}.s_order`，则调度解析依赖为`onedata.s_order`。
    -   如果代码里指定`select * from onedata.s_order`，则调度解析依赖为`onedata.s_order`。
    -   如果代码里指定`select * from onedata_dev.s_order`，则调度解析依赖为`onedata_dev.s_order`。 |
    |**上游依赖**|通过执行如下操作，添加该节点任务调度时依赖的上游节点：    1.  单击**手动添加上游**。
    2.  在**新建上游依赖**对话框中，您可以通过以下两种方式搜索依赖节点：

        -   输入所依赖节点的输出名称的关键字进行搜索节点。
        -   输入**virtual**搜索虚拟节点（每个租户或企业在初始化时都会有一个根节点）。
**说明：** 节点的输出名称是全局唯一的，且不区分大小写。

    3.  单击**确定新增**。
同时您还可以单击**操作**列下的![fagaga](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p88054.png)图标，删除已添加的依赖节点。|
    |**当前节点**|通过执行如下操作，设置当前节点的输出名称，根据需要您可以设置多个输出名称，供其他节点依赖使用：    1.  单击**手动添加输出**。
    2.  在**新增当前节点输出**对话框中，填写输出名称。输出名称的命名规则请尽量统一，一般命名规则为`生成项目名.表名`且不区分大小写，以标识本节点产出的表，同时其他节点更好地选择调度依赖关系。

例如，开发项目名称为`onedata_dev`，建议将输出名称设置为`onedata.s_order`。如果您将输出名称设置为`onedata_dev.s_order`，则仅限代码`select * from onedata_dev.s_order`能解析出上游依赖节点。

    3.  单击**确定新增**。
同时您还可以对当前节点已添加的输出名称执行如下操作：    -   单击**操作**列下的![fagaga](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p88054.png)图标，删除已添加的输出名称。
    -   如果该节点已提交且被任务所依赖（任务已提交），则单击**操作**列下的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p76297.png)图标，查看下游节点。 |


## 步骤五：配置任务参数

Flink\_Template\_SQL任务代码中的通用参数，您可以通过任务参数进行批量配置。

1.  在Flink\_Template\_SQL任务代码开发页面，单击页面上方的**定向配置**。

2.  在**定向配置**面板，任务参数配置区域，配置参数。


## 步骤六：配置模板参数

1.  在Flink\_Template\_SQL代码开发页面，单击页面上方的**模板参数**。

2.  在**模板参数**面板，配置**参数值**。

3.  单击**确定**，完成模板参数的配置。


## 步骤七：提交或发布Flink\_Template\_SQL任务

1.  在Flink\_Template\_SQL任务代码开发页面，单击页面右上方的![test](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9397549951/p112804.png)图标，保存Flink\_Template\_SQL任务。

2.  在Flink\_Template\_SQL任务代码开发页面，单击页面右上方的![taga](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9397549951/p112810.png)图标，提交Flink\_Template\_SQL任务。

3.  在**提交备注**对话框，填写备注信息。

4.  单击**确定并提交**，完成Flink\_Template\_SQL任务的提交。

5.  发布Flink\_Template\_SQL任务至生产环境。

    -   如果您的开发模式是Dev-Prod模式，则需要发布实时计算任务，详情请参见[管理发布任务](/cn.zh-CN/任务发布/管理发布任务.md)。
    -   如果您的开发模式是Basic模式，则提交成功的实时计算任务，即可进入生产环境。

## （可选）调度配置

如果计算任务您已开启为离线模式，则需要配置调度参数。完成调度参数配置后再提交Flink\_Template\_SQL任务。

1.  在Flink\_Template\_SQL任务代码开发页面，单击页面上方的**定向配置**。

2.  在**定向配置**面板的**离线模式**页签，配置任务的调度参数。

    ![gagaga](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1334955061/p176325.png)

    |参数|描述|
    |--|--|
    |**时间属性**|选择**时间属性**。**时间属性**包括：    -   **正常调度**：按照调度周期的时间配置调度，并正常执行，通常任务默认选中该项。
    -   **空跑调度**：按照调度周期的时间配置调度，但都是空跑执行，即一调度到该任务便直接返回成功，没有真正的执行任务。 |
    |**暂停调度**|**暂停调度**选择**是**后，即可暂停该任务的调度，会按照下面的调度周期时间配置调度，但是一旦调度到该任务会直接返回失败，不会执行。通常用于某个任务暂时不用执行，但后面还会继续使用的场景。|
    |**调度周期**|**调度周期**可选择**日**、**周**、**月**、**小时**和**分钟**：    -   **日**调度，即调度任务每天自动运行一次。新建周期任务时，系统默认的时间周期为每天0点运行一次。您可以根据需要，单击![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p76289.png)图标，指定运行的时间点。
    -   **周**调度，即调度任务每周的特定几天，在特定时间点自动运行一次。您可以根据需要，单击![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p76289.png)图标，指定运行的时间点。

如果您没有指定日期，为保证下游实例正常运行，系统会生成实例后直接设置为运行成功，而不会真正执行任何逻辑，也不会占用资源。

    -   **月**调度，即调度任务在每月的特定几天，在特定时间点自动运行一次。您可以根据需要，单击![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p76289.png)图标，指定运行的时间点。

如果在没有被指定的日期时，为保证下游实例正常运行，系统会每天生成实例后直接设置为运行成功，而不会真正执行任何逻辑，也不会占用资源。

    -   **小时**调度，即每天指定的时间段内，调度任务按间隔时间数的时间间隔运行一次。或选择指定的时间点，调度系统会自动为任务生成实例并运行。您可以根据业务需求选中**时间段**或**时间点**：

        -   如果您选中了**时间段**，您可以单击**开始**或**结束**后的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p76289.png)图标，指定运行的开始和结束时间。同时您可以单击**间隔**后的![test](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p129374.png)图标，在下拉列表中选择间隔时间。
        -   如果您选中了**时间点**，单击下拉列表框，在下拉列表中选择时间点。
例如，每天00:00~23:59的时间段内，每隔1小时会自动调度一次，因此调度系统会自动为任务生成实例并运行。

    -   **分钟**调度，即每天指定的时间段内，调度任务按间隔时间数的时间间隔运行一次。 您可以单击**开始**或**结束**后的![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p76289.png)图标，指定运行的开始和结束时间。同时您可以单击**间隔**后的![test](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5197549951/p129374.png)图标，在下拉列表中选择间隔时间。 |
    |**依赖上周期**|根据业务场景分析是否需要选中**依赖上周期**。如果您选择**是**，则需要选择依赖上个调度周期的节点：    -   如果您选择了**当前**，则表示依赖当前节点的上个调度周期。
    -   如果您选择了**自定义**，则需在输入框中输入依赖上周期节点的名称关键字进行搜索节点。 |
    |**优先级**|选择任务参与调度的优先级。**优先级**包括：    -   **最低优先级**。
    -   **低优先级**。
    -   **中等优先级**。
    -   **高优先级**。
    -   **最高优先级**。 |
    |**参数配置**|您可以对代码中所用参数的具体赋值。单击**节点参数配置说明**，查看Dataphin调度系统的配置规则及支持配置的时间参数。|

3.  单击**确定**。


