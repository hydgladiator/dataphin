# 新建实时元表规则

本文为您介绍如何新建实时元表规则。

系统支持创建的实时元表规则说明如下。

|规则类型|描述|
|----|--|
|统计趋势监测|统计趋势监测校验数据值及数据变化趋势。|
|实时多链路对比|在业务有强保障场景中，可以通过实时双链路或实时三链路质量规则，监测数据。如果有异常，运维人员能够及时切换或备份数据。实时多链路对比质量规则支持监控数据滞留、统计偏差等问题。|
|实时离线数据核对|实时数据与离线数据在使用相同统计路逻辑时，实时离线数据核对质量规则可以检测数据之间的差异。如果差异较大，可能存在数据质量的问题。|

## 新建统计趋势监测规则

1.  登录[Dataphin控制台](https://dataphin.console.aliyun.com/workingArea)。

2.  进入**实时元表规则**。

    1.  在Dataphin控制台页面，选择工作区地域后，单击**进入Dataphin\>\>**。

    2.  在Dataphin首页，单击顶部菜单栏中的**资产**。

    3.  在数据**资产**页面，单击顶部菜单栏的**质量**。

    4.  在数据**质量**页面，单击左侧导航栏的**实时元表规则**。

3.  创建质量规则。

    1.  在**实时元表规则**页面，单击**新建质量规则**。

    2.  在**新建质量规则**对话框，选择数据表后单击**开始配置**。

        您也可以选择业务板块、所属项目和表类型筛选数据表。

4.  设置告警。

    1.  单击**告警设置**后的![fagag](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2867528951/p84203.png)图标。

    2.  在**告警设置**对话框，选择**告警接收人**及**告警方式**。

    3.  单击**确定**。

5.  配置质量规则。

    1.  单击**创建质量规则**。

    2.  在**创建质量规则**对话框，配置参数。

        |参数|描述|
        |--|--|
        |规则类型|选择**统计趋势监测**。|
        |规则强度|选择质量规则的强度。|
        |对象名称|选择需要校验的对象。|
        |指标算子|选择数据的算法。|
        |对象形式|选择质量规则与所要校验的数据目标的形式。系统支持选择单值数据和多值数据。如果您选择了多值数据， 则需要配置维度和枚举值。 |
        |时间限定|质量校验类型，不支持修改。|
        |条件限定|选择质量规则扫描数据源的频率。|
        |校验规则|模板名称|选择校验的模板。|
        |对比方式|        -   如果校验类型为波动型，则**对比方式**包括**绝对值**、**向上**、**向下**。
        -   如果校验类型为对比型，则**对比方式**为**大于固定值**、**大于等于固定值**、**等于固定值**、**小于等于固定值绝对值**、**小于固定值**。
详情请参见[表 1](#table_821_s9o_ksb)。|
        |阈值设定|如果模板名称选择为非**与固定值对比**，即为波动型校验，则需要设定质量规则校验结果的波动阈值，波动监测阈值设定在对比值基础上的0~10倍率的范围内。|
        |固定值设定|如果模板名称选择为**与固定值对比**，则需要选择质量规则校验对比的固定值。|
        |监测配置|监测频率|选择质量规则扫描数据源的频率。|
        |监测范围|支持根据业务场景自定义数据监测的时间范围。系统默认为全天扫描。|
        |数据时区|质量规则扫描数据时，数据所采用的的时区。例如，GMT 8即为北京时间23时。|
        |数据预览|完成参数配置后，单击**生成预览**，即可在数据预览区域查看配置的质量规则。如果配置参数修改，单击**刷新预览**， 则质量规则数据刷新。 |

        |模板类型|趋势|配置项|校验类型|
        |----|--|---|----|
        |与固定值对比|大于固定值、大于等于固定值、等于固定值、小于等于固定值绝对值、小于固定值|固定值设定|对比型|
        |与前1天趋势对比|绝对值、向上、向下|波动阈值|波动型|
        |与前7天趋势对比|绝对值、向上、向下|波动阈值|波动型|
        |与前30天趋势对比|绝对值、向上、向下|波动阈值|波动型|
        |与1、7、30天前趋势对比|绝对值、向上、向下|波动阈值|波动型|
        |字段最大值1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |字段最小值1天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |字段最小值1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|

6.  单击**保存**，完成质量规则的配置后，即可试跑规则并开启校验开关。


## 新建实时多链路对比规则

1.  在**创建质量规则**页面，单击**创建质量规则**。

2.  在**创建质量规则**对话框，配置参数。

    |参数|描述|
    |--|--|
    |规则类型|选择**实时多链路对比**。|
    |规则强度|选择质量规则的强度。|
    |对象名称|选择需要校验的对象。|
    |指标算子|选择数据的算法。|
    |对象形式|选择质量规则与所要校验的数据目标的形式。系统支持选择单值数据和多值数据。如果您选择了多值数据， 则需要配置维度和枚举值。 |
    |时间限定|配置实时元表的时间限定。|
    |条件限定|非必配置项，您可以关闭条件限定。如果您开启了条件限定，则需要选择实时元表的字段、类型、条件和限定条件。|
    |校验规则|模板名称|选择质量规则的校验模板。系统支持选择**实时三链路对比**和**实时双链路对比**。|
    |对比链路1|选择实时元表作为对比链路数据：    -   如果模板选择了**实时双链路对比**，则只需要选择一个实时元表。
    -   如果模板选择了**实时三链路对比**，则需要选择两个实时元表。 |
    |偏离类型|选择实时元表作为对比链路数据：    -   如果模板选择了**实时双链路对比**，则系统只支持选择**当前链路与对比链路偏离的范围**。
    -   如果模板选择了**实时三链路对比**，则系统支持选择**当前链路偏移任一对比链路的范围**和**当前链路同时偏移两条对比链路的范围**。 |
    |阈值设定|设定质量规则校验结果的波动阈值，波动监测阈值设定在对比值基础上的0~10倍率的范围内。|
    |监测配置|监测频率|选择质量规则扫描数据源的频率。|
    |监测范围|支持根据业务场景，指定数据监测时段。系统默认为全天扫描。|
    |数据时区|质量规则扫描数据时，数据所采用的的时区。例如，GMT 8即为北京时间23时。|
    |数据预览|完成参数配置后，单击**生成预览**，即可在数据预览区域查看配置的质量规则。如果配置参数修改，单击**刷新预览**， 则质量规则数据刷新。 |

3.  单击**保存**，完成质量规则的配置后，即可试跑规则并开启校验开关。


## 新建实时离线数据核对规则

1.  在**创建质量规则**页面，单击**创建质量规则**。

2.  在**创建质量规则**对话框，配置参数。

    |参数|描述|
    |--|--|
    |规则类型|选择**实时离线数据核对**。|
    |规则强度|选择质量规则的强度。|
    |对象名称|选择需要校验的对象。|
    |指标算子|选择数据的算法|
    |对象形式|选择质量规则与所要校验的数据目标的形式。系统支持选择单值数据和多值数据。如果您选择了多值数据， 则需要配置维度和枚举值。 |
    |时间限定|配置实时元表的时间限定。|
    |条件限定|非必配置项。添加校验条件，选择实时元表的字段、类型、条件和限定条件。|
    |校验规则|模板名称|选择质量规则的校验模板。系统仅支持选择**实时离线数据核对**。|
    |离线数据|选择指定离线表作为校验目标。|
    |分区表达式|配置离线数据分区表达式，分区表达式用于限定数据对比规则。系统支持的分区表达式，请参见|
    |离线取数|通过SQL语句配置离线数据表的取数。单击**参考示例**，查看SQL语法和参数说明。编写完成后，单击**规范性校验**校验SQL语法是否正确、元数据是否存在以及与所选离线数据表是否匹配。 |
    |偏离类型|选择实时元表作为对比链路数据。系统仅支持选择**实时与离线数据的允许差异范围**。|
    |阈值设定|设定质量规则校验结果的波动阈值，波动监测阈值设定在对比值基础上的0~10倍率的范围内。|
    |监测配置|触发条件|默认为表或分区数据更新时触发质量校验规则。|
    |数据时区|质量规则扫描数据时，数据所采用的的时区。例如，GMT 8即为北京时间23时。|

3.  单击**保存**，完成质量规则的配置后，即可试跑规则并开启校验开关。


## 试跑规则

完成统计趋势监测规则、实时离线数据核对规则、实时多链路对比规则创建后，需要试跑规则。

选中新增的数据源规则，单击**规则试跑**。

![teat](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0114633061/p175619.png)

如果实时元表规则的试跑失败，则鼠标悬停至![gegaga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1114633061/p175621.png)图标，单击**试跑日志**，查看日志，定位试跑失败原因。

## 打开校验开关

打开**校验开关**。即可根据实时元表规则定义的频率和生效时间扫描数据源。

![faga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9752673061/p175945.png)

同时，您也可以在**实时元表规则列表**页面，单击![geagag](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1114633061/p175626.png)或![fagaga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1114633061/p175628.png)图标，关闭或打开实时元表规则，即可开启或关闭该数据源的质量校验规则。

![gfaga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9752673061/p175946.png)

